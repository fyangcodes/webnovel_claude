# StyleConfig Abstract Model Implementation Plan

## Overview

Create a reusable `StyleConfig` abstract model that provides comprehensive styling capabilities for taxonomy models (Section, Genre) and potentially other UI elements in the future.

## Design Goals

1. **DRY Principle**: Eliminate duplicate style fields across models
2. **Consistency**: All styled elements follow the same styling system
3. **Extensibility**: Easy to add new style properties without model changes
4. **Future-proof**: Can be applied to Tags, BookMasters, or custom UI elements
5. **Flexibility**: All style fields are optional with sensible defaults

## StyleConfig Abstract Model

### Location
`/myapp/books/models/base.py`

### Fields

#### Color Scheme
- `color` (CharField, max_length=7, blank=True)
  - Primary hex color code (e.g., `#FF5733`)
  - Used for button background, borders, accent colors
  - Help text: "Primary color in hex format (e.g., '#FF5733')"

- `color_hover` (CharField, max_length=7, blank=True)
  - Hover state color (optional)
  - If not set, auto-generated by lightening `color` by 10-20%
  - Help text: "Hover color in hex format (auto-generated if not set)"

- `background_color` (CharField, max_length=7, blank=True)
  - Background color for larger containers
  - Help text: "Background color in hex format"

- `text_color` (CharField, max_length=7, blank=True)
  - Text color (optional)
  - If not set, auto-calculated for proper contrast against `color`
  - Help text: "Text color in hex format (auto-calculated if not set)"

#### Visual Assets
- `background_image` (ImageField/URLField, blank=True)
  - Optional background image for hero sections or cards
  - Help text: "Optional background image URL"

- `icon` (CharField, max_length=50, blank=True)
  - FontAwesome icon class (e.g., 'fa-book', 'fas fa-heart')
  - Help text: "FontAwesome icon class (e.g., 'fa-book')"

#### Typography
- `font_family` (CharField, max_length=100, blank=True)
  - Optional custom font family
  - Falls back to site default if not set
  - Help text: "Custom font family (e.g., 'Roboto', 'Arial')"

- `font_weight` (CharField, max_length=20, blank=True, default='normal')
  - Font weight options: 'normal', 'bold', '300', '400', '500', '600', '700', '800'
  - Help text: "Font weight (normal, bold, 300-800)"

- `font_size_multiplier` (DecimalField, max_digits=3, decimal_places=2, default=1.0)
  - Multiplier for base font size (e.g., 1.2 = 120% of base size)
  - Help text: "Font size multiplier (1.0 = base size, 1.2 = 120%)"

#### Layout
- `border_radius` (CharField, max_length=20, blank=True, default='default')
  - Options: 'default', 'rounded', 'pill', 'square', or custom value like '8px'
  - Help text: "Border radius style (default, rounded, pill, square, or custom like '8px')"

- `custom_css_class` (CharField, max_length=50, blank=True)
  - Optional custom CSS class for special styling
  - Help text: "Optional custom CSS class name"

### Helper Methods

```python
def get_computed_text_color(self):
    """
    Calculate contrasting text color based on background color.
    Returns white (#FFFFFF) or black (#000000) based on luminance.
    """
    if self.text_color:
        return self.text_color

    if not self.color:
        return '#000000'

    # Calculate luminance and return contrasting color
    # Implementation using relative luminance formula
    pass

def get_computed_hover_color(self):
    """
    Generate hover color by lightening the primary color by 15%.
    """
    if self.color_hover:
        return self.color_hover

    if not self.color:
        return None

    # Lighten color by 15% using HSL conversion
    pass

def get_style_dict(self):
    """
    Return a dictionary of all computed styles for easy template access.

    Returns:
        {
            'color': '#FF5733',
            'color_hover': '#FF8555',
            'background_color': '#FFFFFF',
            'text_color': '#FFFFFF',
            'icon': 'fa-book',
            'font_family': 'Roboto',
            'font_weight': 'bold',
            'font_size_multiplier': 1.2,
            'border_radius': 'pill',
            'custom_css_class': 'section-special'
        }
    """
    return {
        'color': self.color,
        'color_hover': self.get_computed_hover_color(),
        'background_color': self.background_color,
        'text_color': self.get_computed_text_color(),
        'icon': self.icon,
        'font_family': self.font_family,
        'font_weight': self.font_weight,
        'font_size_multiplier': float(self.font_size_multiplier),
        'border_radius': self.border_radius,
        'custom_css_class': self.custom_css_class,
    }

def get_inline_style(self):
    """
    Generate inline CSS style string for use in templates.

    Returns: "background-color: #FF5733; color: #FFFFFF; font-weight: bold;"
    """
    styles = []

    if self.color:
        styles.append(f"background-color: {self.color}")
    if self.text_color or self.color:
        styles.append(f"color: {self.get_computed_text_color()}")
    if self.font_family:
        styles.append(f"font-family: {self.font_family}")
    if self.font_weight and self.font_weight != 'normal':
        styles.append(f"font-weight: {self.font_weight}")
    if self.font_size_multiplier != 1.0:
        styles.append(f"font-size: {self.font_size_multiplier}em")
    if self.background_image:
        styles.append(f"background-image: url('{self.background_image}')")

    return "; ".join(styles) + ";" if styles else ""
```

### Meta Configuration

```python
class Meta:
    abstract = True
```

## Model Updates

### Section Model Changes

**File**: `/myapp/books/models/taxonomy.py`

**Before**:
```python
class Section(TimeStampedModel):
    # ... existing fields ...
    icon = models.CharField(...)
```

**After**:
```python
class Section(TimeStampedModel, StyleConfig):
    # ... existing fields (remove icon since it's in StyleConfig) ...
```

**Fields to remove**: `icon` (now in StyleConfig)

### Genre Model Changes

**File**: `/myapp/books/models/taxonomy.py`

**Before**:
```python
class Genre(TimeStampedModel):
    # ... existing fields ...
    icon = models.CharField(...)
    color = models.CharField(...)
```

**After**:
```python
class Genre(TimeStampedModel, StyleConfig):
    # ... existing fields (remove icon and color since they're in StyleConfig) ...
```

**Fields to remove**: `icon`, `color` (now in StyleConfig)

## Database Migration Strategy

### Step 1: Create StyleConfig Abstract Model
- Add StyleConfig to `books/models/base.py`
- Import necessary utilities (colorsys for color manipulation)

### Step 2: Migration Sequence
Because Django abstract models with multiple inheritance can be tricky:

1. **Add new StyleConfig fields to Section and Genre** (keep old fields)
   - Run `makemigrations`
   - This creates new fields without removing old ones

2. **Data migration**: Copy data from old fields to new
   - `icon` → (already exists in StyleConfig)
   - `color` → (already exists in StyleConfig for Genre)

3. **Remove old duplicate fields** (if any conflicts)
   - Run `makemigrations` to remove deprecated fields

### Step 3: Update Seed Data
Update `/myapp/books/management/commands/seed_taxonomy.py`:

**Section Colors**:
- Fiction: `#3498db` (blue) - Traditional, trustworthy
- BL: `#e91e63` (pink/rose) - Romantic, warm
- GL: `#9c27b0` (purple) - Elegant, unique
- Non-fiction: `#4caf50` (green) - Fresh, educational

**Genre Colors** (examples):
- Fantasy: `#8e44ad` (purple)
- Romance: `#e74c3c` (red)
- Sci-Fi: `#3498db` (blue)
- Mystery: `#34495e` (dark gray)
- Adventure: `#f39c12` (orange)

**Style Properties**:
```python
Section.objects.create(
    name="Fiction",
    slug="fiction",
    color="#3498db",
    font_weight="600",
    border_radius="pill",
    icon="fas fa-book",
    # ... other fields
)
```

## CSS Implementation

### File: `/myapp/reader/static/reader/css/styles.css`

Add new section for styled navigation buttons:

```css
/* ===========================
   StyleConfig-based Navigation Buttons
   =========================== */

/* Base styling for section nav buttons */
.section-nav-btn {
    padding: 0.6rem 1.5rem;
    font-size: 1rem;
    border: none;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.section-nav-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.section-nav-btn.active {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    transform: translateY(-1px);
}

/* Genre buttons (smaller, inline) */
.genre-badge {
    padding: 0.4rem 1rem;
    font-size: 0.9rem;
    border-radius: 1rem;
    border: 1px solid;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    transition: all 0.2s ease;
}

.genre-badge:hover {
    transform: scale(1.05);
}
```

## Template Updates

### File: `/myapp/reader/templates/reader/base.html`

**Section Nav (lines 99-122)**:

**Before**:
```django
<a href="{% url 'reader:section_home' current_language.code nav_section.slug %}"
   class="btn btn-sm {% if section and section.slug == nav_section.slug %}btn-primary-custom{% else %}btn-outline-primary-custom{% endif %}">
    {% if nav_section.icon %}<i class="{{ nav_section.icon }} me-1"></i>{% endif %}
    {{ nav_section.localized_name }}
</a>
```

**After**:
```django
<a href="{% url 'reader:section_home' current_language.code nav_section.slug %}"
   class="section-nav-btn rounded-pill {% if section and section.slug == nav_section.slug %}active{% endif %}"
   style="{{ nav_section.get_inline_style }}"
   data-ajax-nav="section"
   data-section-slug="{{ nav_section.slug }}">
    {% if nav_section.icon %}<i class="{{ nav_section.icon }} me-1"></i>{% endif %}
    {{ nav_section.localized_name }}
</a>
```

### Genre Display (example for future use):

```django
{% for genre in book.genres.all %}
    <span class="genre-badge"
          style="{{ genre.get_inline_style }}">
        {% if genre.icon %}<i class="{{ genre.icon }}"></i>{% endif %}
        {{ genre.localized_name }}
    </span>
{% endfor %}
```

## Implementation Checklist

- [ ] Create StyleConfig abstract model in `/myapp/books/models/base.py`
- [ ] Implement color utility methods (luminance calculation, color lightening)
- [ ] Update Section model to inherit from StyleConfig
- [ ] Update Genre model to inherit from StyleConfig
- [ ] Create and apply database migrations
- [ ] Update `seed_taxonomy` command with comprehensive style data
- [ ] Add CSS classes for styled navigation in `styles.css`
- [ ] Update `base.html` template to use StyleConfig fields
- [ ] Test section navigation appearance in browser
- [ ] Verify color contrast for accessibility (WCAG AA standards)
- [ ] Test hover effects and active states
- [ ] Document usage in CLAUDE.md

## Testing Plan

1. **Visual Testing**:
   - Check section nav on all pages
   - Verify colors render correctly
   - Test hover and active states
   - Check responsive behavior on mobile

2. **Accessibility Testing**:
   - Verify color contrast ratios (minimum 4.5:1 for AA)
   - Test with screen readers
   - Ensure keyboard navigation works

3. **Database Testing**:
   - Verify migrations run without errors
   - Check that existing data is preserved
   - Test rollback if needed

4. **Cross-browser Testing**:
   - Chrome/Edge
   - Firefox
   - Safari (if available)

## Future Enhancements

1. **Admin Interface**: Create visual color picker in Django admin
2. **Theme Presets**: Provide predefined color schemes (light, dark, vibrant, muted)
3. **Dynamic Theming**: Allow users to customize section colors
4. **CSS Variables**: Generate CSS custom properties from StyleConfig
5. **Gradient Support**: Add gradient color options
6. **Animation Options**: Add transition/animation preferences
7. **Responsive Styles**: Different styles for mobile vs desktop

## Notes

- All style fields are optional to maintain backward compatibility
- Auto-calculation of text color ensures accessibility
- Inline styles are generated server-side for performance
- Custom CSS classes allow for special cases without model changes
- The system is extensible to Tags, BookMasters, or any future models needing styling
