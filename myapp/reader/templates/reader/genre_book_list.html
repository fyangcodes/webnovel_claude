{% extends "reader/base.html" %}
{% load books_extras %}
{% load static %}

{% block title %}{{ current_genre.name }} - {{ current_language.name }} Books{% endblock %}

{% block extra_css %}
<style>
    /* Fixed height book cards */
    .book-card {
        height: 100%;
        min-height: 380px;
        max-height: 380px;
    }
    .book-card .row.g-0 {
        height: 100%;
    }
    .book-card .col-5,
    .book-card .col-7 {
        height: 100%;
    }
    .book-card .card-body {
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    .book-card .flex-grow-1 {
        flex: 1 1 auto;
        min-height: 0; /* Allow content to shrink if needed */
        overflow: hidden;
    }
    .book-card .mt-auto {
        flex-shrink: 0; /* Prevent stats section from shrinking */
    }

    .book-card:hover .card-title {
        max-height: none;
        overflow: visible;
        z-index: 10;
        background: white;
        color: #333;
    }
    .book-card:hover .card-title::after {
        content: none;
    }
    /* Dark mode for card title hover */
    [data-theme="dark"] .book-card:hover .card-title {
        background: #353535;
        color: #d4d4d4;
    }
    /* Description with ellipsis at 7 lines */
    .book-description-container {
        display: -webkit-box;
        -webkit-line-clamp: 7;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Genre Filter Header -->
        <div class="card border-0 shadow-sm mb-4" style="background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 50%, #a78bfa 100%);">
            <div class="card-body p-4 text-white">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h3 class="card-title mb-2 fw-bold">
                            <i class="fas fa-tag me-2"></i>{{ current_genre.name }}
                        </h3>
                    </div>
                    <div>
                        <a href="{% url 'reader:book_list' current_language.code %}" class="btn btn-light">
                            <i class="fas fa-times me-1"></i> Clear Filter
                        </a>
                    </div>
                </div>
            </div>
        </div>

        {% if books %}
        <div class="row">
            {% for book in books %}
            {% include "reader/partials/reader_book_card.html" with book=book current_language=current_language %}
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if is_paginated %}
        <nav aria-label="Books pagination" class="mt-5">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1">First</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
                </li>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                <li class="page-item active">
                    <span class="page-link">{{ num }}</span>
                </li>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                </li>
                {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

        {% else %}
        <!-- Empty State -->
        <div class="text-center py-5">
            <div class="display-1 text-muted mb-3">ðŸ“š</div>
            <h3 class="text-muted">No books available</h3>
            <p class="text-muted">
                There are no published {{ current_genre.name }} books in {{ current_language.name }} yet.
            </p>
            <a href="{% url 'reader:book_list' current_language.code %}" class="btn btn-outline-primary">
                View All Books
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
