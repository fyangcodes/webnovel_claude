{% extends "reader/base.html" %}
{% load i18n %}
{% load static %}
{% load reader_extras %}

{% block title %}{{ section_localized_name }} - literatures{% endblock %}

{% block extra_css %}
<!-- Section-specific meta tags for JavaScript -->
<meta name="section-slug" content="{{ section.slug }}">
<meta name="language-code" content="{{ current_language.code }}">

<!-- SEO Meta Tags -->
{% seo_meta_tags 'section' section=section language=current_language %}

<!-- Canonical URL -->
<link rel="canonical" href="{% canonical_url request %}">

<!-- Structured Data -->
{% structured_data 'organization' site_name='wereadly' url=request.build_absolute_uri %}
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Section Header -->
    <div class="section-header mb-5">
        <div class="section-header-content">
            <h1 class="section-title">
                {% if section.icon %}
                <i class="{{ section.icon }} me-2"></i>
                {% endif %}
                {{ section_localized_name }}
            </h1>
            {% if section.description %}
            <div class="section-description-wrapper">
                <p class="section-description collapsed" id="sectionDescription">
                    {{ section_localized_description }}
                </p>
                <button class="section-description-toggle btn btn-link p-0"
                        id="descriptionToggle"
                        aria-expanded="false"
                        aria-controls="sectionDescription">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Section Genres -->
    {% if section_genres %}
    <div class="mb-5">
        <h2 class="h4 mb-3">{% trans "Browse by Genre" %}</h2>
        <div class="d-flex flex-wrap gap-2"><a href="{% url 'reader:section_book_list' current_language.code section.slug %}" class="btn-genre">{% trans "All Genres" %}</a>{% for genre in section_genres %}{% if genre.is_primary %}<a href="{% url 'reader:section_book_list' current_language.code section.slug %}?genre={{ genre.slug }}" class="btn-genre">{% if genre.icon %}<i class="{{ genre.icon }} me-1"></i>{% endif %}{{ genre.localized_name }}</a>{% endif %}{% endfor %}</div>
    </div>
    {% endif %}

    <!-- Recent Books -->
    {% if books %}
    {% include "reader/partials/organisms/book_grid.html" with books=books title=_("Recent Updates") section=section current_language=current_language %}
    {% else %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        {% trans "No books available in this section yet." %}
    </div>
    {% endif %}

    <!-- Featured Books (if configured) -->
    {% if featured_books %}
    {% include "reader/partials/organisms/book_grid.html" with books=featured_books title=_("Featured") section=section current_language=current_language %}
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<!-- Section Navigation JavaScript -->
<script src="{% static 'reader/js/section-navigation.js' %}"></script>
<script>
    // Enable debug mode for development
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        window.SectionNavigation.config.debugMode = true;
    }

    // Section description toggle
    document.addEventListener('DOMContentLoaded', function() {
        const descriptionToggle = document.getElementById('descriptionToggle');
        const sectionDescription = document.getElementById('sectionDescription');

        if (descriptionToggle && sectionDescription) {
            descriptionToggle.addEventListener('click', function() {
                const isExpanded = sectionDescription.classList.contains('expanded');

                if (isExpanded) {
                    sectionDescription.classList.remove('expanded');
                    sectionDescription.classList.add('collapsed');
                    descriptionToggle.setAttribute('aria-expanded', 'false');
                    descriptionToggle.querySelector('i').classList.remove('fa-chevron-up');
                    descriptionToggle.querySelector('i').classList.add('fa-chevron-down');
                } else {
                    sectionDescription.classList.remove('collapsed');
                    sectionDescription.classList.add('expanded');
                    descriptionToggle.setAttribute('aria-expanded', 'true');
                    descriptionToggle.querySelector('i').classList.remove('fa-chevron-down');
                    descriptionToggle.querySelector('i').classList.add('fa-chevron-up');
                }
            });
        }
    });
</script>
{% endblock %}
