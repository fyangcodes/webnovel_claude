{% load static %}
{% load books_extras %}

<!DOCTYPE html>
<html lang="{{ current_language.code|default:'en' }}" class="bg-red-300 dark:bg-green-400">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %} - wereadly</title>

    <!-- Dark mode script - prevent FOUC -->
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'reader/favicon.ico' %}">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Reader App Styles -->
    <link href="{% static 'reader-tw/css/output.css' %}" rel="stylesheet">

    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- Navigation -->
    <nav class="nav-bar">
        <!-- Left Side Navigation -->
        <div class="flex-none">
            <a  href="{% if current_language %}{% url 'reader:welcome' current_language.code %}{% else %}/{% endif %}">
                <img src="{% static 'reader/images/logo_final.png' %}" alt="wereadly logo" class="h-8">
            </a>
        </div>

        <!-- Inline Breadcrumb -->
        {% if current_language %}
        <div class="flex-none">            
            {% block breadcrumb_section %}
                {% block breadcrumb_check %}
                {# This block will be overridden in child templates to show breadcrumb #}
                {% endblock %}
            {% endblock %}            
        </div>
        {% endif %}

        <!-- Genres Dropdown-->
        {% if genres %}
        <div class="flex-auto relative" id="genres-dropdown-container">
            <button class="nav-item" id="genres-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <ul id="genres-dropdown" class="dropdown-menu hidden absolute left-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-50">
                <li>
                    <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700" href="{% url 'reader:genre_list' current_language.code %}">
                        All genres
                    </a>
                    <br>                    
                </li>
                {% for genre in genres %}
                <li>
                    <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700" href="{% url 'reader:genre_book_list' current_language.code genre.slug %}">
                        {{ genre.localized_name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- Theme Switcher -->
        <div class="flex-none">
            <button type="button" id="theme-toggle" class="nav-item">
                <i class="fas fa-moon" id="theme-icon-moon"></i>
                <i class="fas fa-sun"id="theme-icon-sun"></i>
            </button>
        </div>

        <!-- Language Switcher -->
        {% if languages %}
        <div class="flex-none relative" id="language-dropdown-container">
            <button type="button" id="language-toggle" class="nav-item">
                <i class="fas fa-globe"></i>
            </button>
            <ul id="language-dropdown" class="dropdown-menu hidden absolute right-0 mt-2 w-36 bg-white dark:bg-gray-800 rounded-md shadow-lg z-50 py-1">
                {% for lang in languages %}
                <li>
                    <a class="dropdown-item block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 {% if lang == current_language %}bg-blue-100 dark:bg-blue-900{% endif %}" href="{% url 'reader:welcome' lang.code %}">
                        <div class="flex justify-between gap-4">
                            <span class="font-bold text-sm">{{ lang.code|upper }}</span>
                            <span class="text-sm">{{ lang.local_name }}</span>
                        </div>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </nav>

    <!-- Main Content -->
    <main >
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer >
        <div >
            <p >Â© 2025 wereadly</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="{% static 'reader-tw/js/script.js' %}"></script>

    {% block extra_js %}{% endblock %}
</body>
</html>